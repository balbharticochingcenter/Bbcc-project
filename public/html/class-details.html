<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Details - BBCC</title>
    <link rel="stylesheet" href="/css/login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Specific tweaks for Details Page */
        .details-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px 8%;
            align-items: start;
        }
        
        .subjects-column h2 { color: var(--primary); margin-bottom: 20px; border-bottom: 2px solid #334155; padding-bottom: 10px; }
        
        .subject-item-box {
            background: rgba(30, 41, 59, 0.5);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(56, 189, 248, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-column { position: sticky; top: 100px; }
        
        .video-container {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--primary);
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
        }

        /* Teacher Slider Section */
        .teacher-slider-wrap {
            grid-column: 1 / -1;
            margin-top: 40px;
            text-align: center;
        }
        
        .t-card-container {
            display: flex;
            overflow: hidden;
            gap: 20px;
            padding: 20px;
            justify-content: center;
        }

        .t-card {
            min-width: 200px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            transition: 0.3s;
        }
        
        .t-card img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--success); }

        .enroll-now-btn {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            background: linear-gradient(90deg, #ef4444, #b91c1c);
            color: white;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            text-transform: uppercase;
        }

        @media (max-width: 850px) {
            .details-wrapper { grid-template-columns: 1fr; }
            .video-column { position: static; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-left"><div class="logo-ring"><img src="" id="siteLogo" class="logo"></div></div>
        <div class="nav-center">
            <div class="brand-info">
                <h1 class="glow-text rainbow-header" id="siteTitle">Loading...</h1>
                <span class="powered-by" id="siteSubTitle"></span>
            </div>
        </div>
        <div class="nav-right">
            <button class="dropbtn" onclick="window.location.href='/'"><i class="fa fa-home"></i> Home</button>
        </div>
    </nav>

    <div class="details-wrapper">
        <div class="subjects-column">
            <h2 id="classNameHeading">Class Details</h2>
            <div id="subjectListContainer">
                </div>
        </div>

        <div class="video-column">
            <div class="video-container">
                <iframe id="mainYtPlayer" width="100%" height="100%" src="" frameborder="0" allowfullscreen></iframe>
            </div>
            <button class="enroll-now-btn" onclick="window.location.href='/?action=login'">
                <i class="fa fa-user-plus"></i> Enroll Now (Login First)
            </button>
        </div>

        <div class="teacher-slider-wrap">
            <h2 class="magical-text">Meet Our Teachers</h2>
            <div class="t-card-container" id="teacherDisplay">
                </div>
        </div>
    </div>

    <footer class="modern-footer">
        <div class="footer-container">
            <div class="footer-bottom">
                <p id="footerAbout" style="text-align: center; color: #94a3b8;"></p>
                <hr style="margin: 15px 0; border: 0.5px solid #334155;">
                <p class="dev-credit" style="text-align: center;">Website Developed by <span>Santosh Sir "Ethical Hacker"</span></p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const targetClass = params.get('class');

            // 1. Load Global Settings (Header/Footer)
            const settingsRes = await fetch('/api/admin/hp-settings');
            const settings = await settingsRes.json();
            document.getElementById('siteLogo').src = settings.header.logo;
            document.getElementById('siteTitle').innerText = settings.header.title;
            document.getElementById('siteSubTitle').innerText = settings.header.subTitle;
            document.getElementById('footerAbout').innerText = settings.footer.about;

            // 2. Load Class Details
            const classRes = await fetch('/api/admin/all-classes');
            const allClasses = await classRes.json();
            const clsData = allClasses.find(c => c.className === targetClass);

            if (clsData) {
                document.getElementById('classNameHeading').innerText = `Subjects for ${clsData.className}`;
                
                // Show Intro Video from first subject
                if (clsData.subjects[0]?.ytLinks[0]) {
                    const videoId = extractID(clsData.subjects[0].ytLinks[0]);
                    document.getElementById('mainYtPlayer').src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1`;
                }

                // Render Subjects Left
                const subContainer = document.getElementById('subjectListContainer');
                const teacherContainer = document.getElementById('teacherDisplay');
                
                clsData.subjects.forEach(sub => {
                    // Subject Row
                    subContainer.innerHTML += `
                        <div class="subject-item-box">
                            <div>
                                <b style="font-size:1.1rem; color:white;">${sub.name}</b><br>
                                <small style="color:var(--primary)">Expert: ${sub.teacher}</small>
                            </div>
                            <i class="fa fa-book-open" style="color: #444;"></i>
                        </div>
                    `;

                    // Teacher Card Bottom
                    teacherContainer.innerHTML += `
                        <div class="t-card">
                            <img src="/assets/teacher-default.png" alt="Teacher">
                            <h4 style="margin-top:10px;">${sub.teacher}</h4>
                            <p style="font-size:0.8rem; color:var(--primary);">${sub.name} Specialist</p>
                        </div>
                    `;
                });
            }
        });

        function extractID(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
    </script>
</body>
</html>
