<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Details - BBCC Portal</title>
    <link rel="stylesheet" href="/css/login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .details-container {
            display: flex;
            gap: 30px;
            padding: 40px 8%;
            min-height: 80vh;
            flex-wrap: wrap;
        }
        .details-left { flex: 1.5; min-width: 300px; }
        .video-right { 
            flex: 1; 
            min-width: 300px; 
            background: rgba(255,255,255,0.05); 
            padding: 20px; 
            border-radius: 20px;
            border: 1px solid var(--primary);
            height: fit-content;
        }
        .subject-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
        }
        .teacher-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #444;
        }
        .teacher-img {
            width: 50px; height: 50px; border-radius: 50%; object-fit: cover;
            border: 2px solid var(--success);
        }
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 10px;
        }
        .video-wrapper iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        .enroll-sticky {
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            background: var(--danger);
            color: white;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-left">
            <img src="" alt="Logo" class="logo" id="siteLogo">
        </div>
        <div class="nav-center">
            <div class="brand-info">
                <h1 class="glow-text" id="siteTitle">Loading...</h1>
                <span class="powered-by" id="siteSubTitle"></span>
            </div>
        </div>
        <div class="nav-right">
            <button class="dropbtn" onclick="window.location.href='/'">Home</button>
        </div>
    </nav>

    <div class="details-container">
        <div class="details-left">
            <h1 id="displayClassName" style="font-size: 2.5rem; margin-bottom: 10px;" class="glow-text">Class Name</h1>
            <p id="classMoto" style="color: #94a3b8; margin-bottom: 30px;">Explore the subjects and specialized teachers for this class.</p>
            
            <div id="subjectsListArea">
                </div>
        </div>

        <div class="video-right">
            <h3 style="margin-bottom: 15px; color: var(--primary);">Class Introduction</h3>
            <div class="video-wrapper">
                <iframe id="introVideo" src="" frameborder="0" allowfullscreen></iframe>
            </div>
            <button class="enroll-sticky" onclick="alert('Please Login to Enroll!')">Enroll Now in This Class</button>
        </div>
    </div>

    <footer class="modern-footer">
        <div class="footer-container">
            <div class="footer-bottom">
                <p id="footerAbout" style="text-align: center; margin-bottom: 10px;"></p>
                <hr>
                <p class="dev-credit" style="text-align: center;">Developed by Santosh Sir</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const className = urlParams.get('class');

            if (!className) {
                window.location.href = '/';
                return;
            }

            // 1. Load Header/Footer Settings
            const settingsRes = await fetch('/api/admin/hp-settings');
            if (settingsRes.ok) {
                const data = await settingsRes.json();
                document.getElementById('siteLogo').src = data.header.logo;
                document.getElementById('siteTitle').innerText = data.header.title;
                document.getElementById('siteSubTitle').innerText = data.header.subTitle;
                document.getElementById('footerAbout').innerText = data.footer.about;
            }

            // 2. Load Class Details from DB
            try {
                const classRes = await fetch('/api/admin/all-classes');
                const classes = await classRes.json();
                const cls = classes.find(c => c.className === className);

                if (cls) {
                    document.getElementById('displayClassName').innerText = cls.className;
                    
                    // Set Intro Video (First Video of First Subject as default or manual)
                    if(cls.subjects[0] && cls.subjects[0].ytLinks[0]) {
                        const vidId = extractYtId(cls.subjects[0].ytLinks[0]);
                        document.getElementById('introVideo').src = `https://www.youtube.com/embed/${vidId}`;
                    }

                    // Render Subjects & Teachers
                    const listArea = document.getElementById('subjectsListArea');
                    cls.subjects.forEach(sub => {
                        const card = document.createElement('div');
                        card.className = 'subject-card';
                        card.innerHTML = `
                            <h3>ðŸ“˜ ${sub.name}</h3>
                            <p style="font-size:0.9rem; color:#ccc;">Total Videos Available: ${sub.ytLinks.length}</p>
                            <div class="teacher-info">
                                <img src="/assets/teacher-default.png" class="teacher-img">
                                <div>
                                    <p style="font-weight:bold; color:var(--success);">${sub.teacher || 'Assigning...'}</p>
                                    <p style="font-size:0.8rem;">Subject Expert</p>
                                </div>
                            </div>
                        `;
                        listArea.appendChild(card);
                    });
                }
            } catch (err) {
                console.error("Error:", err);
            }
        });

        function extractYtId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
    </script>
</body>
</html>
