<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class Room Login - Bal Bharti Coaching</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,Tahoma;}
body{
background:linear-gradient(135deg,#1e3c72,#2a5298);
min-height:100vh;display:flex;align-items:center;justify-content:center
}
.login-container{
background:#fff;border-radius:15px;max-width:420px;width:100%;
padding:30px;box-shadow:0 15px 35px rgba(0,0,0,.3)
}
.logo{text-align:center;margin-bottom:25px}
.logo h1{color:#1e3c72;font-size:28px}
.logo p{color:#666;font-size:14px}
.form-group{margin-bottom:18px}
label{font-weight:600;color:#333;font-size:14px}
.input-with-icon{position:relative}
.input-with-icon i{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:#666}
input{
width:100%;padding:12px 12px 12px 44px;
border:2px solid #ddd;border-radius:8px;font-size:16px
}
input:focus{border-color:#1e3c72;outline:none}
.btn{
width:100%;padding:14px;background:#1e3c72;
color:#fff;border:none;border-radius:8px;
font-size:16px;font-weight:600;cursor:pointer
}
.btn:disabled{background:#aaa}
.message{margin:15px 0;padding:10px;border-radius:8px;font-size:14px;display:none}
.error{background:#fee2e2;color:#b91c1c;display:block}
.success{background:#dcfce7;color:#166534;display:block}
.user-type-indicator{display:none;margin-top:15px;font-size:14px}
.type-badge{padding:5px 12px;border-radius:20px;font-size:12px;font-weight:700}
.student{background:#3b82f6;color:#fff}
.teacher{background:#10b981;color:#fff}
.admin{background:#dc2626;color:#fff}
.security-note{
margin-top:20px;background:#fffbeb;border:1px solid #facc15;
padding:10px;border-radius:8px;font-size:12px;color:#92400e
}
</style>
</head>

<body>

<div class="login-container">
<div class="logo">
<h1>üîê Class Room Login</h1>
<p>Bal Bharti Coaching Center</p>
</div>

<div id="msg" class="message"></div>

<form id="loginForm">
<div class="form-group">
<label>User ID</label>
<div class="input-with-icon">
<i class="fas fa-user"></i>
<input id="userId" required autocomplete="off">
</div>
</div>

<div class="form-group">
<label>Password</label>
<div class="input-with-icon">
<i class="fas fa-lock"></i>
<input id="password" type="password" required autocomplete="off">
</div>
</div>

<button class="btn" id="btn">Join Classroom</button>
</form>

<div id="typeBox" class="user-type-indicator">
Detected as: <span id="badge" class="type-badge"></span>
<span id="uname"></span>
</div>

<div class="security-note">
<i class="fas fa-shield-alt"></i>
Direct classroom access is blocked. Login required.
</div>
</div>

<script>
const form=document.getElementById("loginForm");
const msg=document.getElementById("msg");
const btn=document.getElementById("btn");
const badge=document.getElementById("badge");
const typeBox=document.getElementById("typeBox");
const uname=document.getElementById("uname");

function show(text,type){
msg.textContent=text;
msg.className="message "+type;
msg.style.display="block";
}

function detect(id){
id=id.toUpperCase();
if(id.startsWith("ADM")) return "admin";
if(id.startsWith("TCH")||id.startsWith("TEA")) return "teacher";
return "student";
}

function setType(type,name=""){
typeBox.style.display="block";
badge.className="type-badge "+type;
badge.textContent=type.toUpperCase();
uname.textContent=name?(" ‚Ä¢ "+name):"";
}

form.onsubmit=async e=>{
e.preventDefault();
btn.disabled=true;

const userId=userId.value.trim();
const password=password.value.trim();
const guess=detect(userId);
setType(guess);

try{
const res=await fetch(`/api/classroom/verify?userId=${userId}&password=${password}&userType=${guess}`);
const data=await res.json();

if(!data.success){
show("Invalid ID or Password","error");
btn.disabled=false;return;
}

setType(data.userType,data.user.name);

let roomId=null;

if(data.userType!=="student"){
const r=await fetch("/api/classroom/create",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({teacherId:userId,className:data.user.name+"'s Class"})
});
const rd=await r.json();
roomId=rd.roomId;
}else{
const r=await fetch("/api/classroom/active-rooms");
const rd=await r.json();
if(!rd.rooms.length){
show("Classroom not started yet. Wait for teacher.","error");
btn.disabled=false;return;
}
roomId=rd.rooms[0].roomId;
}

show("Login successful. Joining class‚Ä¶","success");

setTimeout(()=>{
location.href=`/classroom.html?userId=${userId}&userType=${data.userType}&name=${encodeURIComponent(data.user.name)}&roomId=${roomId}`;
},800);

}catch(err){
show("Server error. Try again.","error");
btn.disabled=false;
}
};
</script>

</body>
</html>
